<div class="space-y-6">
  <h1 class="text-2xl font-semibold text-zinc-100">Access</h1>

  <!-- Tabs -->
  <div class="flex gap-6 border-b border-zinc-800 text-sm">
    <button
      class="pb-2 transition"
      [class.text-cyan-400]="activeTab === 'requests'"
      (click)="setTab('requests')"
    >
      My Requests
    </button>

    <button
      class="pb-2 transition"
      [class.text-cyan-400]="activeTab === 'approvals'"
      (click)="setTab('approvals')"
    >
      Approvals
    </button>

    <button
      class="pb-2 transition"
      [class.text-cyan-400]="activeTab === 'memberships'"
      (click)="setTab('memberships')"
    >
      My Memberships
    </button>
  </div>

  <!-- ================= MY REQUESTS ================= -->
  <div *ngIf="activeTab === 'requests'" class="space-y-4">
    <h2 class="text-sm uppercase tracking-wide text-zinc-400">Access Requests Raised By You</h2>

    <p *ngIf="loading" class="text-zinc-400 text-sm">Loading requests…</p>

    <div *ngIf="!loading && myRequests.length === 0" class="text-zinc-500">
      You haven’t raised any access requests yet.
    </div>

    <div *ngIf="myRequests.length" class="overflow-x-auto border border-zinc-800 rounded-lg">
      <table class="min-w-full text-sm text-left">
        <thead class="bg-zinc-900 border-b border-zinc-800">
          <tr>
            <th class="px-4 py-3 text-zinc-400">Application</th>
            <th class="px-4 py-3 text-zinc-400">Role</th>
            <th class="px-4 py-3 text-zinc-400">Justification</th>
            <th class="px-4 py-3 text-zinc-400">Status</th>
            <th class="px-4 py-3 text-zinc-400">Requested</th>
            <th class="px-4 py-3 text-zinc-400">Updated</th>
            <th class="px-4 py-3 text-zinc-400">Updated By</th>
          </tr>
        </thead>

        <tbody>
          <tr
            *ngFor="let r of myRequests"
            class="border-b border-zinc-800 hover:bg-zinc-900 transition"
          >
            <td class="px-4 py-3 text-zinc-100">{{ r.app_name }}</td>
            <td class="px-4 py-3 text-zinc-300">{{ r.role_name }}</td>
            <td class="px-4 py-3 text-zinc-400 max-w-xs truncate">
              {{ r.justification || '—' }}
            </td>
            <td class="px-4 py-3">
              <span
                class="text-xs font-medium px-2 py-1 rounded"
                [ngClass]="{
                  'bg-yellow-500/10 text-yellow-400': r.status === 'pending',
                  'bg-green-500/10 text-green-400': r.status === 'approved',
                  'bg-red-500/10 text-red-400': r.status === 'rejected'
                }"
              >
                {{ r.status }}
              </span>
            </td>
            <td class="px-4 py-3 text-zinc-500">
              {{ r.created_at }}
            </td>
            <td class="px-4 py-3 text-zinc-500">
              {{ r.updated_at }}
            </td>
            <td class="px-4 py-3 text-zinc-500">
              {{ r.updated_by }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ================= APPROVALS ================= -->
  <div *ngIf="activeTab === 'approvals'" class="space-y-4">
    <h2 class="text-sm uppercase tracking-wide text-zinc-400">Requests Awaiting Your Approval</h2>

    <p *ngIf="loading" class="text-zinc-400 text-sm">Loading approvals…</p>

    <div *ngIf="!loading && myApprovals.length === 0" class="text-zinc-500">
      No pending approvals.
    </div>

    <div *ngIf="myApprovals.length" class="overflow-x-auto border border-zinc-800 rounded-lg">
      <table class="min-w-full text-sm text-left">
        <thead class="bg-zinc-900 border-b border-zinc-800">
          <tr>
            <th class="px-4 py-3 text-zinc-400">User</th>
            <th class="px-4 py-3 text-zinc-400">Application</th>
            <th class="px-4 py-3 text-zinc-400">Role</th>
            <th class="px-4 py-3 text-zinc-400">Justification</th>
            <th class="px-4 py-3 text-zinc-400">Requested</th>
            <th class="px-4 py-3 text-zinc-400 text-right">Actions</th>
          </tr>
        </thead>

        <tbody>
          <tr
            *ngFor="let r of myApprovals"
            class="border-b border-zinc-800 hover:bg-zinc-900 transition"
          >
            <td class="px-4 py-3 text-zinc-100">{{ r.user_email }}</td>
            <td class="px-4 py-3 text-zinc-300">{{ r.app_name }}</td>
            <td class="px-4 py-3 text-zinc-300">{{ r.role_name }}</td>
            <td class="px-4 py-3 text-zinc-400 max-w-xs truncate">
              {{ r.justification || '—' }}
            </td>
            <td class="px-4 py-3 text-zinc-500">
              {{ r.created_at | date : 'mediumDate' }}
            </td>
            <td class="px-4 py-3 text-right space-x-2">
              <button
                class="text-green-400 hover:text-green-300 text-xs font-medium"
                (click)="approve(r.id)"
              >
                Approve
              </button>
              <button
                class="text-red-400 hover:text-red-300 text-xs font-medium"
                (click)="reject(r.id)"
              >
                Reject
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ================= MEMBERSHIPS ================= -->
  <div *ngIf="activeTab === 'memberships'" class="space-y-4">
    <h2 class="text-sm uppercase tracking-wide text-zinc-400">Your Active Memberships</h2>

    <p *ngIf="loading" class="text-zinc-400 text-sm">Loading memberships…</p>

    <div *ngIf="!loading && myMemberships.length === 0" class="text-zinc-500">
      You are not a member of any roles yet.
    </div>

    <div *ngIf="myMemberships.length" class="overflow-x-auto border border-zinc-800 rounded-lg">
      <table class="min-w-full text-sm text-left">
        <thead class="bg-zinc-900 border-b border-zinc-800">
          <tr>
            <th class="px-4 py-3 text-zinc-400">Application</th>
            <th class="px-4 py-3 text-zinc-400">Role</th>
            <th class="px-4 py-3 text-zinc-400">Granted On</th>
            <th class="px-4 py-3 text-zinc-400">Granted By</th>
          </tr>
        </thead>

        <tbody>
          <tr
            *ngFor="let m of myMemberships"
            class="border-b border-zinc-800 hover:bg-zinc-900 transition"
          >
            <td class="px-4 py-3 text-zinc-100">{{ m.app_name }}</td>
            <td class="px-4 py-3 text-cyan-400">{{ m.role_name }}</td>
            <td class="px-4 py-3 text-zinc-500">
              {{ m.created_at | date : 'mediumDate' }}
            </td>
            <td class="px-4 py-3 text-zinc-500">
              {{ m.created_by || 'System' }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
